package com.athapong.arcodeapp;

import java.io.File;
import java.lang.reflect.Array;

import android.app.Activity;  
import android.graphics.Bitmap;
import android.os.Bundle; 
import android.util.Log;
import android.widget.ImageView;
import android.widget.TextView;
import android.widget.Toast;
import org.opencv.android.BaseLoaderCallback;
import org.opencv.android.LoaderCallbackInterface;
import org.opencv.android.OpenCVLoader;
import org.opencv.core.Core;
import org.opencv.core.Mat;
import org.opencv.core.Size;
import org.opencv.highgui.Highgui;
import org.opencv.imgproc.Imgproc;

public class MyProcess extends Activity {
		String getPath;
		String TAG = null;
		Mat image,gImg,bImg,tImg;
		ImageView myIV;
		Bitmap tempImg;
		 private BaseLoaderCallback mLoaderCallback = new BaseLoaderCallback(this) {

		        @Override
		        public void onManagerConnected(int status) {
		            switch (status) {
		                case LoaderCallbackInterface.SUCCESS:
		                {
		                    Log.i(TAG, "OpenCV loaded successfully");
		                    getMyMat(getPath);
		                    if(image!=null){
		                    	
		                    	gImg = (Mat) convertGray(image);
		                    	//resize(src, dst, dst.size(), 0, 0, interpolation);
		                    	//Blur Img
		                    	//org.opencv.core.Size s = new Size(5,3);
		                    	//Imgproc.GaussianBlur(gImg,bImg,s,0);
		                    	//AdaptiveThreshold -> classify as either black or white
		                    	//Imgproc.adaptiveThreshold(bImg, tImg, 255, Imgproc.ADAPTIVE_THRESH_MEAN_C, Imgproc.THRESH_BINARY, 5, 2);
		                    }
		                } break;
		                default:
		                {
		                    super.onManagerConnected(status);
		                } break;
		            }
		            
		        }
		    };
	public void onCreate(Bundle savedInstanceState){
		super.onCreate(savedInstanceState);  
        setContentView(R.layout.activity_myprocess);
        myIV = (ImageView) this.findViewById(R.id.myIV);
        // get Data from CaptureActivity
        getPath = getIntent().getStringExtra("currentPath");
        Toast myToast = Toast.makeText(this,getPath, Toast.LENGTH_LONG);
		myToast.show();
        
	}
	
	@Override
    public void onResume()
    {
        super.onResume();
        OpenCVLoader.initAsync(OpenCVLoader.OPENCV_VERSION_2_4_8, this, mLoaderCallback);
    }
	
	public Mat getMyMat(String inputPath){
		image = Highgui.imread(inputPath);
		if(image==null){
			Toast myToast = Toast.makeText(this,"image is null", Toast.LENGTH_LONG);
			myToast.show();
		}else{
			Toast myToast = Toast.makeText(this,"image is not null", Toast.LENGTH_LONG);
			myToast.show();
		}
		return image;
		
	}

	public Mat convertGray(Mat inputMat){
		Imgproc.cvtColor(inputMat, inputMat, Imgproc.COLOR_RGB2GRAY);
		Toast myToast = Toast.makeText(this,"image is gray", Toast.LENGTH_LONG);
		myToast.show();
		return inputMat;
	}
}
